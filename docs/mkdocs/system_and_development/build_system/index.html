
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.3">
    
    
      
        <title>ADORe Build System - ADORe Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.79e020e9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adore-build-system" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ADORe Documentation" class="md-header__button md-logo" aria-label="ADORe Documentation" data-md-component="logo">
      
  <img src="../../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ADORe Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ADORe Build System
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ADORe Documentation" class="md-nav__button md-logo" aria-label="ADORe Documentation" data-md-component="logo">
      
  <img src="../../../img/logo.png" alt="logo">

    </a>
    ADORe Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../about_adore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../quick_start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/system_requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/prerequisites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prerequisites
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/installing_docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basic Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Basic Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../basic_usage/first_scenario/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running Your First Scenario
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Technical Reference Manual
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Technical Reference Manual
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System and Development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../control_system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Control System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interfaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doxygen_documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Doxygen Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Module Quick Reference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../questions_and_answers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Questions and Answers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../problems_and_solutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Problems and Solutions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_help/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Help
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../adore_status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADORe Status
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-interface-normalization" class="md-nav__link">
    Build interface normalization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-configuration-management" class="md-nav__link">
    Dependency configuration management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#artifacts" class="md-nav__link">
    Artifacts
  </a>
  
    <nav class="md-nav" aria-label="Artifacts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-artifacts" class="md-nav__link">
    Build artifacts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-images" class="md-nav__link">
    Docker images
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-artifacts" class="md-nav__link">
    Log artifacts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-anatomy" class="md-nav__link">
    Module anatomy
  </a>
  
    <nav class="md-nav" aria-label="Module anatomy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    Makefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interface-makefile-mk" class="md-nav__link">
    Interface makefile .mk
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#files-directory" class="md-nav__link">
    'files' directory
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-composition" class="md-nav__link">
    Module Composition
  </a>
  
    <nav class="md-nav" aria-label="Module Composition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hierarchic-composition" class="md-nav__link">
    Hierarchic Composition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#open-composition" class="md-nav__link">
    Open Composition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="adore-build-system">ADORe Build System</h1>
<p>The ADORe build system is a docker build and runtime  environment for ADORe.</p>
<h2 id="background">Background</h2>
<p>Although ADORe is primarily centered around ROS there is also stand-alone 
components in a conglomeration of technologies such as python, C++ and others.
Each component could have their own respective build and run steps. The primary 
aim of the build system is to normalize complex build processes, as well as, 
provide a containerized runtime for these processes with a focus of 
configuration management of dependencies and software reuse.</p>
<h2 id="build-interface-normalization">Build interface normalization</h2>
<p>The ADORe build system aims to provide per module predictable building and 
testing interfaces via GNU Make such as: 'make build', 'make test, and more.</p>
<p>GNU Make is not a new tool however it is stable and familiar to many developers.
For this reason it was selected as the centralized "glue" for the ADORe build
system. GNU Make offers "documentation-as-code" for ADORe capturing complex 
build, testing, and execution processes, steps, and commands into a single 
location. To discover the capabilities of a given module, or what a module can 
do, simple inspect the provided Makefile. It is up to the developer of a module 
to provide interesting or relevant targets for the project or module. At minimum
'make build', 'make test', and 'make clean' should be provided by a module. 
Review the <a href="#modules">modules</a> section for more detail on what constitutes a 
module.</p>
<h2 id="dependency-configuration-management">Dependency configuration management</h2>
<p>In a standard Dockerfile it can be difficult to manage or version system 
dependencies because system dependencies are globed together often on one line. 
The following is a typical example that could be  found in a Dockerfile for 
installing system dependencies following docker "best practices":</p>
<pre><code class="language-Dockerfile">...
RUN apt-get update &amp;&amp; apt-get install -y a b c &amp;&amp; \
    rm -rf /var/lib/apt/lists/*
...
</code></pre>
<p>The problem with this is dependencies tend to change while the build procedure 
may not. In this previous example the dependencies namely a, b, and c are all 
grouped on one line. This makes updating, versioning, tracking/documenting \
(where did the dependency come from or what needs it), and composing dependencies
difficult.</p>
<p>The next example used throughout the ADORe build system adds complexity but also 
has a number of distinct benefits:</p>
<pre><code class="language-Dockerfile">...
ARG REQUIREMENTS_FILE
...
RUN apt-get update &amp;&amp; \
    apt-get install --no-install-recommends -y $(sed '/^#/d' ${REQUIREMENTS_FILE} | sed '/^$/d') &amp;&amp; \
    rm -rf /var/lib/apt/lists/*
...
</code></pre>
<p>The previous example provides the following benefits:</p>
<ul>
<li>Dependencies can be tracked in an independent file such as in the case with
adore_if_ros_msg: requirements.adore_if_ros_msg.ubuntu20.04.system
If the base system is changed or upgraded then all that needs to be updated is 
the dependency file.</li>
<li>There is one dependency per line such as the following example for <a href="https://github.com/DLR-TS/adore_if_ros_msg/blob/bed4d8987c864628404b2c8e79735c08946635f4/files/requirements.adore_if_ros_msg.ubuntu20.04.system#L4">g++</a></li>
<li>Discovering dependencies within the system is easy
With the following shell command run on the top level of the ADORe project
all dependencies within the project can be discovered: <code>find -name "requirements.*.ubuntu20.04.system"</code></li>
<li>Composition of dependencies becomes trivial</li>
<li>Building up new docker contexts that pull in dependencies from other modules is 
possible because the dependency files are separate</li>
<li>Using sed to filter the dependency file allows the use of "#" comments within 
the file. This is useful to documenting/commenting and managing individual 
dependencies.</li>
</ul>
<p>In general there will be a <code>files/requirements.&lt;module&gt;.&lt;base system&gt;.system</code> 
file that contains all necessary dependencies for that module for example: 
"<a href="https://github.com/DLR-TS/adore_if_ros_msg/blob/master/files/requirements.adore_if_ros_msg.ubuntu20.04.system">requirements.adore_if_ros_msg.ubuntu20.04.system</a>" which is the system 
dependency file for adore_if_ros_msg.  Furthermore, the system dependency files 
can be segregated into separate files based off of life-cycle context such as 
build dependencies and run dependencies. This is true for modules such as 
libadore which has a <a href="https://github.com/DLR-TS/adore_if_ros/blob/master/files/requirements.adore_if_ros.build.ubuntu20.04.system">build requirements file</a> and a <a href="https://github.com/DLR-TS/adore_if_ros/blob/master/files/requirements.adore_if_ros.runtime.ubuntu20.04.system">runtime requirements file</a>. 
Although, it is not strictly essential to separate build and runtime system 
dependencies it makes management and composition of dependencies easier with the
effect of lowering overall docker context sizes.</p>
<h2 id="modules">Modules</h2>
<p>ADORe relies heavily on git submodules for code reuse and boundaries. </p>
<ul>
<li>In general every directory is a module and potentially a stand-alone project</li>
<li>Every module will provide a Makefile and a Dockerfile </li>
<li>Every module will have at minimum a 'build' and 'clean' make target</li>
</ul>
<h3 id="artifacts">Artifacts</h3>
<p>Every module will generate artifacts in some form during their respective
life-cycles. This section will detail the possible artifacts.</p>
<h4 id="build-artifacts">Build artifacts</h4>
<p>Every module that produces build artifacts follows the same basic pattern. All 
build artifacts generated by 'make build' will generate a build directory with 
the following path: <code>&lt;repository name&gt;/&lt;module name&gt;/build</code>
This could contain binaries, cmake install prefix, headers, Debian packages 
et cetera. </p>
<h4 id="docker-images">Docker images</h4>
<p>In general every module will produce at least a build docker image. If a module
requires a runtime context or other contexts these will be generated as well.
For example on the module <a href="https://github.com/DLR-TS/libadore">libadore</a>.
produces the following images:</p>
<p><img alt="Libadore Docker Images" src="../images/libadore_docker_image_ls.jpg" /></p>
<p>In the case of libadore there is a docker context for build which contains
only the build artifacts, a test context which can be used to execute unit tests
and the main context. What docker images/contexts are produced with make build
are dependent on the module needs.</p>
<p>The internal file system layout for each module will be the same and follow the
same pattern.  All project files will be placed in /tmp/<module name> within the
docker context.</p>
<p>In the case of project containing ROS packages the structure will be: 
<code>/tmp/&lt;module name&gt;/&lt;module name&gt;</code> where the first directory contains the docker
context with Makefile and requirements file and the second directory with the 
same module name will be a standard ROS package with a CMakeLists.txt,
package.xml and any other necessary files. Running 'ls' on the /tmp/libadore 
directory within the libadore build context yields this familiar structure:
<img alt="Libadore Docker project directory" src="../images/libadore_ls.jpg" /></p>
<h4 id="log-artifacts">Log artifacts</h4>
<p>Some modules produce log output during various life cycle phases for example
during build, test, or execution. This log output will be placed in the 
following path: <code>&lt;repository name&gt;/.log/</code>.
Which logs a module generates is wholly dependent on the module in question.
For more information on this please refer to individual documentation within 
a module.</p>
<h3 id="module-anatomy">Module anatomy</h3>
<p>The following section will detail the basic anatomy of a module. At minimum 
every module will have a Makefile and a Dockerfile</p>
<h4 id="makefile">Makefile</h4>
<p>At minimum every module should have a Makefile with 'build' and clean 'targets'
defined. The Makefile provides "documentation-as-code" so if you are wondering
what capabilities a module offers the first place to look is the Makefile. </p>
<p>The makefile also provides important environmental variables for docker build
and docker run such as a docker tag and potentially other important 
environmental variables relevant to the module.</p>
<p>In general every module should provide a <code>make help</code> target to guild users on 
module capabilities. The 'help' target used throughout the ADORe ecosystem is a
spin on the following github gist: <a href="https://gist.github.com/prwhite/8168133">https://gist.github.com/prwhite/8168133</a> and is 
provided by the make_gadgets project at: <a href="https://github.com/DLR-TS/make_gadgets">https://github.com/DLR-TS/make_gadgets</a>.
Any Makefile that has <code>include make_gadgets/make_gadgets.mk</code> will have a 
<code>make help</code> target. </p>
<p>Any target or recipe that has two hash symbols such as the following example
Makefile:</p>
<pre><code class="language-Makefile">include make_gadgets/make_gadgets.mk

.PHONY: test_target
test_target: ## this is a test target
        echo &quot;Hello, World!&quot;
</code></pre>
<p>will output the comment and target name with the invocation of <code>make help</code>. 
Calling <code>make help</code> on the previous example Makefile would then yield the 
following:</p>
<p><img alt="Example make help output" src="../images/make_help.jpg" /></p>
<p>As can be seen in the previous image the make_gadgets project also provides
another very important recipe/target that is used throughout the ADORe 
ecosystem specifically the "get_sanitized_branch_name". Calling this target 
returns the branch name or hash that has been sanitized such that it can be 
used as a docker image tag. This will be further detailed in a later section.</p>
<p>For more information on how the help target works please review the 
documentation for
https://github.com/DLR-TS/make_gadgets or the gist at 
https://gist.github.com/prwhite/8168133</p>
<p>The Makefile provides the primary means to interact with a module directly by 
navigating to a module and running make commands on the module. </p>
<h4 id="dockerfile">Dockerfile</h4>
<p>The Dockerfile is pretty self-explanatory and in general every module will have
a Dockerfile in its root. More dockerfiles may be provided by a module if 
necessary depending if the module also requires runtime context. If there are
many docker files within a module then they can be organized in a subdirectory 
called 'docker'. GNU Make is used primarily to invoke <code>docker</code> or 
<code>docker compose</code> within ADORe.</p>
<h4 id="interface-makefile-mk">Interface makefile <module name>.mk</h4>
<p>Many modules within ADORe have two makefiles namely 'Makefile' and 
'<module name>.mk'. The first makefile ('Makefile') allows make commands to be
run directly on the module by navigating to the module directory in a shell and
running for example <code>make build</code> or <code>make clean</code>. </p>
<p>The second makefile having the same name of the module itself (for example in 
adore_if_ros_msg: adore_if_ros_msg.mk) acts as the external interface for the 
module.  The basic question for this makefile is what behavior, context, and 
environmental variables should be exported from the module.<br />
This makefile will include the following:</p>
<ul>
<li>Important environmental variables for the module (such as docker tag) </li>
<li>All the necessary make includes (does the module depend on other modules?)</li>
<li>All targets that should be externally visible to downstream projects</li>
</ul>
<p>The self-named makefile included in each module is the external interface for
the module. </p>
<p>Take this minimal example makefile which includes adore_if_ros_msg.mk:</p>
<pre><code class="language-Makefile">include make_gadgets/make_gadgets.mk
include adore_if_ros_msg/adore_if_ros_msg.mk

.PHONY: test_target
test_target: ## this is a test target
        echo &quot;Hello, World!&quot;
</code></pre>
<p>By including adore_if_ros_msg.mk all of the exported targets are now available.
Calling <code>make help</code> now on this example Makefile yields the following output:</p>
<p><img alt="Example make help output with adore_if_ros_msg.mk included" src="../images/adore_if_ros_msg_help.jpg" /></p>
<p>This allows composition of modules.</p>
<p>The self-named makefile previous discussed also provides a number of important 
dynamic environmental variables which follow the basic form: </p>
<pre><code class="language-text">&lt;module name&gt;_PROJECT
&lt;module name&gt;_MAKEFILE_PATH
&lt;module name&gt;_SUBMODULES_PATH
&lt;module name&gt;_TAG
&lt;module name&gt;_IMAGE
</code></pre>
<p>For example in the module adore_if_ros_msg the following environmental variables
are provided:</p>
<pre><code class="language-text">ADORE_IF_ROS_MSG_IMAGE= ${ADORE_IF_ROS_MSG_PROJECT}:${ADORE_IF_ROS_MSG_TAG}
ADORE_IF_ROS_MSG_MAKEFILE_PATH= /home/akoerner/repos/csa/github.com/eclipse/test/adore_if_ros_msg
ADORE_IF_ROS_MSG_PROJECT= adore_if_ros_msg
ADORE_IF_ROS_MSG_SUBMODULES_PATH= /home/akoerner/repos/csa/github.com/eclipse/test/adore_if_ros_msg
ADORE_IF_ROS_MSG_TAG= master
</code></pre>
<p>The environmental variables that a module provides is up to the module author 
but the previously detailed variables are common.  The most important variable 
being the <code>&lt;module name&gt;_IMAGE</code>, <code>&lt;module name&gt;_PROJECT</code>, and 
<code>&lt;module name&gt;_TAG</code> variables which are all relevant for docker image building 
and tagging. </p>
<h4 id="files-directory">'files' directory</h4>
<p>By convention most modules include a 'files' directory; this files directory
contains any context that should be included during build using the docker 
<code>COPY</code> key word such as entry point shell scripts, requirements files et cetera.</p>
<h3 id="module-composition">Module Composition</h3>
<p>The ADORe build system offers two methods of module composition which will be
detailed below. </p>
<h4 id="hierarchic-composition">Hierarchic Composition</h4>
<p>In general a module only has visibility into the contents within said module.
This allows modules to be cloned and operated on in complete isolation to
parent context. This is useful for building up complex CI processes. The
following image illustrates the concept:</p>
<p><img alt="Hierarchic Composition" src="../images/hierarchial_composition.png" /></p>
<p>A give module will have all necessary dependencies within it's tree. Any node
within the tree can be cloned, built and tested in isolation. This requires
recursive cloning; here is an example of adore_if_ros_msg being cloned, built
and tested: </p>
<pre><code class="language-bash">git clone git clone --recursive -j8 git@github.com:DLR-TS/adore_if_ros_msg.git
cd adore_if_ros_msg
make build
make test
</code></pre>
<p>Hierarchic composition has a number of benefits but also carries significant
drawbacks. Development can be cumbersome because every reference to a module
within a project then needs to be updated with any change. </p>
<h4 id="open-composition">Open Composition</h4>
<p>To address the previously discussed drawback of hierarchic module composition 
open module composition is also supported within the ADORe ecosystem. This
allows all modules to be placed in a flat directory structure. The pitfall being
that all required modules must be present in this directory structure otherwise
Make operations will fail.</p>
<p>The following image illustrates the concept of open module composition:</p>
<p><img alt="Open Composition" src="../images/open_composition.png" /></p>
<p>Open module composition is achieved by introducing the <code>SUBMODULES_PATH</code>
environmental variable. This must be defined either by the current environment
or by a parent Makefile when invoking a make action on a module. </p>
<p>If the <code>SUBMODULES_PATH</code> variable is not defined and a give module has not been
recursively cloned running any make target on a submodule/module will yield the
following error:</p>
<pre><code class="language-bash">adore_if_ros_msg(e9019d5) (2)&gt; make help 
INFO: To clone submodules use: 'git submodule update --init --recursive'
INFO: To specify alternative path for submodules use: SUBMODULES_PATH=&quot;&lt;path to submodules&gt;&quot; make build'
INFO: Default submodule path is: /home/akoerner/repos/csa/github.com/eclipse/adore/adore_if_ros_msg'
adore_if_ros_msg.mk:21: *** &quot;ERROR: /home/akoerner/repos/csa/github.com/eclipse/adore/adore_if_ros_msg/make_gadgets 
does not exist. Did you clone the submodules?&quot;.  Stop.
</code></pre>
<p>To avoid this error the <code>SUBMODULES_PATH</code> environmental variable has to be
sourced. This can be done in one of two ways.</p>
<ol>
<li>source the provided adore.env file into your interactive shell. CD to the root of the adore project and run:</li>
</ol>
<pre><code class="language-bash">source adore.env
</code></pre>
<p>This will define and export the <code>SUBMODULES_PATH</code> environmental variable for you. After this you can go to any module and invoke make commands such as <code>make build</code> and <code>make clean</code></p>
<ol>
<li>The second option is to simply provide the <code>SUBMODULES_PATH</code> environmental variable directly when invoking make such as follows:</li>
</ol>
<pre><code class="language-bash">cd adore_if_ros_msg
SUBMODULES_PATH=&quot;$(realpath ..)&quot; make build
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6eac0284.min.js"></script>
      
    
  </body>
</html>